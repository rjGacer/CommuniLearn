datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

//
// USER
//
model User {
  id        Int     @id @default(autoincrement())
  name      String
  email     String  @unique
  // optional profile fields
  bio       String?
  picture   String?
  studentId String?
  password  String
  role      String  @default("student")
  approved  Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  enrollments  Enrollment[]
  quizAttempts QuizAttempt[]
}

//
// MODULE
//
model Module {
  id           Int      @id @default(autoincrement())
  title        String
  description  String
  teacherEmail String
  mediaUrl     String?
  documentPath String?
  mediaPath    String?
  createdAt    DateTime @default(now())

  quizzes       Quiz[]
  comments      ModuleComment[]
  announcements Announcement[]
  submissions   Submission[]
  enrollments   Enrollment[]
}

//
// ENROLLMENT
//
model Enrollment {
  id           Int    @id @default(autoincrement())
  studentEmail String
  moduleId     Int

  user   User   @relation(fields: [studentEmail], references: [email])
  module Module @relation(fields: [moduleId], references: [id])
}

//
// QUIZ
//
model Quiz {
  id           Int       @id @default(autoincrement())
  title        String
  description  String?
  totalPoints  Int?
  timeLimit    Int?
  dueDate      DateTime?
  teacherEmail String
  attemptLimit Int?      @default(1)

  moduleId Int?
  module   Module? @relation(fields: [moduleId], references: [id])

  createdAt DateTime       @default(now())
  questions QuizQuestion[]
  attempts  QuizAttempt[]
}

//
// QUIZ QUESTION
//
model QuizQuestion {
  id       Int     @id @default(autoincrement())
  quizId   Int
  type     String
  question String
  options  String
  answer   String
  files    String?
  points   Int?

  quiz Quiz @relation(fields: [quizId], references: [id])

  attempts QuizAttempt[]
}

//
// QUIZ ATTEMPT
//
model QuizAttempt {
  id             Int      @id @default(autoincrement())
  quizId         Int
  quizQuestionId Int?
  studentEmail   String
  answers        String
  createdAt      DateTime @default(now())

  quiz     Quiz          @relation(fields: [quizId], references: [id])
  question QuizQuestion? @relation(fields: [quizQuestionId], references: [id])
  user     User          @relation(fields: [studentEmail], references: [email])
}

//
// MODULE COMMENTS
//
model ModuleComment {
  id          Int      @id @default(autoincrement())
  text        String
  authorName  String
  authorEmail String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  moduleId Int
  module   Module @relation(fields: [moduleId], references: [id])
}

//
// ANNOUNCEMENT
//
model Announcement {
  id           Int      @id @default(autoincrement())
  teacherEmail String
  description  String
  filePath     String?
  // original filename as uploaded by user (keeps extension and friendly name)
  fileName     String?
  createdAt    DateTime @default(now())

  Module   Module? @relation(fields: [moduleId], references: [id])
  moduleId Int?

  comments AnnouncementComment[]
}

//
// ANNOUNCEMENT COMMENTS
//
model AnnouncementComment {
  id             Int      @id @default(autoincrement())
  announcementId Int
  authorName     String
  authorEmail    String
  text           String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  announcement Announcement @relation(fields: [announcementId], references: [id])
}

// Attendance
model Attendance {
  id           Int       @id @default(autoincrement())
  teacherEmail String
  description  String
  dueDate      DateTime?
  createdAt    DateTime  @default(now())

  marks    AttendanceMark[]
  comments AttendanceComment[]
}

model AttendanceMark {
  id           Int      @id @default(autoincrement())
  attendanceId Int
  studentEmail String
  createdAt    DateTime @default(now())

  attendance Attendance @relation(fields: [attendanceId], references: [id])
}

model AttendanceComment {
  id           Int      @id @default(autoincrement())
  attendanceId Int
  authorName   String
  authorEmail  String
  text         String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  attendance Attendance @relation(fields: [attendanceId], references: [id])
}

//
// SUBMISSION
//
model Submission {
  id           Int      @id @default(autoincrement())
  moduleId     Int
  studentEmail String
  filePath     String?
  createdAt    DateTime @default(now())

  module Module @relation(fields: [moduleId], references: [id])
}
